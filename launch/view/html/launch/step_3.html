<?php echo $header; ?>
<?php echo $nav; ?>
<div class="container">
    <header>
        <div class="row">
            <div class="col-12">
                <h1 class="float-left">3<small>/4</small></h1>
                <h3>
                    <?php echo $heading_title; ?><br /><small>
                        <?php echo $text_step_3; ?></small>
                </h3>
            </div>
        </div>
    </header>

    <?php if($warning_err) : ?>
    <div class="alert alert-danger alert-dismissible">
        <i class="fas fa-exclamation-circle"></i>
        <?php echo $warning_err; ?>
        <button type="button" class="close" data-dismiss="alert">&times;</button>
    </div>
    <?php endif; ?>

    <div class="row">
        <div class="col-sm-12">
            <form action="<?php echo $action; ?>" method="POST" enctype="multipart/form-data" class="form-horizontal">
                <p>
                    <?php echo $text_personal; ?>
                </p>
                <fieldset>
                    <div class="form-group form-row required">
                        <label for="input-firstname" class="col-sm-2 col-form-label">
                            <?php echo $entry_firstname; ?></label>

                        <div class="col-sm-10">
                            <input type="text" name="firstname" placeholder="<?php echo $entry_firstname; ?>" value="<?php echo $firstname; ?>"
                                id="input-firstname" class="form-control">
                            <?php if($firstname_err) : ?>
                            <div class="text-danger">
                                <?php echo $firstname_err; ?>
                            </div>
                            <?php endif; ?>
                        </div>
                    </div>

                    <div class="form-group form-row required">
                        <label for="input-lastname" class="col-sm-2 col-form-label">
                            <?php echo $entry_lastname; ?></label>

                        <div class="col-sm-10">
                            <input type="text" name="lastname" placeholder="<?php echo $entry_lastname; ?>" value="<?php echo $lastname; ?>"
                                id="input-lastname" class="form-control">
                            <?php if($lastname_err) : ?>
                            <div class="text-danger">
                                <?php echo $lastname_err; ?>
                            </div>
                            <?php endif; ?>
                        </div>
                    </div>

                    <div class="form-group form-row required">
                        <label for="input-telephone" class="col-sm-2 col-form-label">
                            <?php echo $entry_telephone; ?></label>

                        <div class="col-sm-10">
                            <input type="text" name="telephone" placeholder="<?php echo $entry_telephone; ?>" value="<?php echo $telephone; ?>"
                                id="input-telephone" class="form-control">
                            <?php if($telephone_err) : ?>
                            <div class="text-danger">
                                <?php echo $telephone_err; ?>
                            </div>
                            <?php endif; ?>
                        </div>
                    </div>

                    <div class="form-group form-row">
                        <label for="input-fax" class="col-sm-2 col-form-label">
                            <?php echo $entry_fax; ?></label>

                        <div class="col-sm-10">
                            <input type="text" name="fax" placeholder="<?php echo $entry_fax; ?>" value="<?php echo $fax; ?>"
                                id="input-fax" class="form-control">
                        </div>
                    </div>
                </fieldset>
                <p>
                    <?php echo $text_address; ?>
                </p>
                <fieldset>
                    <div class="form-group form-row">
                        <label for="input-company" class="col-sm-2 col-form-label">
                            <?php echo $entry_company; ?></label>

                        <div class="col-sm-10">
                            <input type="text" name="company" placeholder="<?php echo $entry_company; ?>" value="<?php echo $company; ?>"
                                id="input-company" class="form-control">
                        </div>
                    </div>
                    <div class="form-group form-row required">
                        <label for="input-country" class="col-sm-2 col-form-label">
                            <?php echo $entry_country; ?></label>

                        <div class="col-sm-10">
                            <select name="country_id" id="input-country" class="form-control">
                                <option value="">
                                    <?php echo $text_select; ?>
                                </option>
                                <?php foreach($countries as $country) : ?>
                                <?php if($country['country_id'] == $country_id) : ?>
                                <option value="<?php echo $country['country_id']; ?>" selected="selected">
                                    <?php echo $country['name']; ?>
                                </option>
                                <?php else : ?>
                                <option value="<?php echo $country['country_id']; ?>">
                                    <?php echo $country['name']; ?>
                                </option>
                                <?php endif; ?>
                                <?php endforeach; ?>
                            </select>
                            <?php if($country_id_err) : ?>
                            <div class="text-danger">
                                <?php echo $country_id_err; ?>
                            </div>
                            <?php endif; ?>
                        </div>
                    </div>
                    <div class="form-group form-row required">
                        <label for="input-address-1" class="col-sm-2 col-form-label">
                            <?php echo $entry_address_1; ?></label>

                        <div class="col-sm-10">
                            <input type="text" name="address_1" placeholder="<?php echo $entry_address_1; ?>" value="<?php echo $address_1; ?>"
                                id="input-address-1" class="form-control">
                            <?php if($address_1_err) : ?>
                            <div class="text-danger">
                                <?php echo $address_1_err; ?>
                            </div>
                            <?php endif; ?>
                        </div>
                    </div>
                    <div class="form-group form-row">
                        <label for="input-address-2" class="col-sm-2 col-form-label">
                            <?php echo $entry_address_2; ?></label>

                        <div class="col-sm-10">
                            <input type="text" name="address_2" placeholder="<?php echo $entry_address_2; ?>" value="<?php echo $address_2; ?>"
                                id="input-address-2" class="form-control">
                            <?php if($address_2_err) : ?>
                            <div class="text-danger">
                                <?php echo $address_2_err; ?>
                            </div>
                            <?php endif; ?>
                        </div>
                    </div>
                    <div class="form-group form-row required">
                        <label for="input-city" class="col-sm-2 col-form-label">
                            <?php echo $entry_city; ?></label>

                        <div class="col-sm-10">
                            <input type="text" name="city" placeholder="<?php echo $entry_city; ?>" value="<?php echo $city; ?>"
                                id="input-city" class="form-control">
                            <?php if($city_err) : ?>
                            <div class="text-danger">
                                <?php echo $city_err; ?>
                            </div>
                            <?php endif; ?>
                        </div>
                    </div>
                    <div class="form-group form-row required">
                        <label for="input-zone" class="col-sm-2 col-form-label">
                            <?php echo $entry_zone; ?></label>

                        <div class="col-sm-10">
                            <select name="zone_id" id="input-zone" class="form-control"></select>
                            <?php if($zone_id_err) : ?>
                            <div class="text-danger">
                                <?php echo $zone_id_err; ?>
                            </div>
                            <?php endif; ?>
                        </div>
                    </div>
                    <div class="form-group form-row required">
                        <label for="input-postcode" class="col-sm-2 col-form-label">
                            <?php echo $entry_postcode; ?></label>

                        <div class="col-sm-10">
                            <input type="text" name="postcode" placeholder="<?php echo $entry_postcode; ?>" value="<?php echo $postcode; ?>"
                                id="input-postcode" class="form-control">
                            <?php if($postcode_err) : ?>
                            <div class="text-danger">
                                <?php echo $postcode_err; ?>
                            </div>
                            <?php endif; ?>
                        </div>
                    </div>
                </fieldset>
                <p>
                    <?php echo $text_db_administration; ?>
                </p>
                <fieldset>
                    <div class="form-group form-row required">
                        <label for="input-email" class="col-sm-2 col-form-label">
                            <?php echo $entry_email; ?></label>

                        <div class="col-sm-10">
                            <input type="text" name="email" placeholder="<?php echo $entry_email; ?>" value="<?php echo $email; ?>"
                                id="input-email" class="form-control">
                            <?php if($email_err) : ?>
                            <div class="text-danger">
                                <?php echo $email_err; ?>
                            </div>
                            <?php endif; ?>
                        </div>
                    </div>
                    <div class="form-group form-row required">
                        <label for="input-password" class="col-sm-2 col-form-label">
                            <?php echo $entry_password; ?></label>

                        <div class="col-sm-10">
                            <input type="text" name="password" placeholder="<?php echo $entry_password; ?>" value="<?php echo $password; ?>"
                                id="input-password" class="form-control">
                            <?php if($password_err) : ?>
                            <div class="text-danger">
                                <?php echo $password_err; ?>
                            </div>
                            <?php endif; ?>
                        </div>
                    </div>
                </fieldset>
                <div class="buttons">
                    <div class="float-left">
                        <a href="<?php echo $back; ?>" class="btn btn-default btn-sm">
                            <?php echo $button_back; ?></a>
                    </div>
                    <div class="float-right">
                        <input type="submit" value="<?php echo $button_continue; ?>" class="btn btn-primary btn-sm" />
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
<?php echo $footer; ?>
<script type="text/javascript">
    var zone = [];

    $('select[name=\'country_id\']').on('change', function () {
        var element = this;

        $(element).prop('disabled', true);

        $('select[name=\'zone_id\']').prop('disabled', true);

        if (!zone[$(element).val()]) {
            $.ajax({
                url: 'index.php?url=launch/step_3/country&country_id=' + $(element).val(),
                dataType: 'json',
                beforeSend: function () {
                    $(element).prop('disabled', true);
                },
                complete: function () {
                    $(element).prop('disabled', false);
                },
                success: function (json) {
                    console.log(json);
                    zone[$(element).val()] = json;

                    if (json['postcode_required'] == 1) {
                        $('input[name=\'postcode\']').parent().parent().addClass('required');
                    } else {
                        $('input[name=\'postcode\']').parent().parent().removeClass('required');
                    }

                    html = '<option value=""><?php echo $text_select; ?></option>';

                    if (json['zone'] && json['zone'] != '') {
                        for (i = 0; i < json['zone'].length; i++) {
                            html += '<option value="' + json['zone'][i]['zone_id'] + '">' + json[
                                'zone'][i]['name'] + '</option>';
                        }
                    } else {
                        html += '<option value"0"><?php echo $text_none; ?></option>';
                    }

                    $('select[name=\'zone_id\']').html(html);

                    $('select[name=\'zone_id\']').prop('disabled', false);

                    $(element).prop('disabled', false);

                    $('select[name$=\'[country_id]\']:disabled:first').trigger('change');
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
                }
            });
        } else {
            html = '<option value=""><?php echo $text_select; ?></option>';

            if (zone[$(element).val()]['zone'] && zone[$(element).val()]['zone'] != '') {
                for (i = 0; i < zone[$(element).val()]['zone'].length; i++) {
                    html += '<option value="' + zone[$(element).val()]['zone'][i]['zone_id'] + '">' + zone[$(
                        element).val()]['zone'][i]['name'] + '</option>';
                }
            } else {
                html += '<option value"0"><?php echo $text_none; ?> </option>';
            }

            $('select[name=\'zone_id\']').html(html);

            $('select[name=\'zone_id\']').prop('disabled', false);

            $(element).prop('disabled', false);

            $('select[name$=\'[country_id]\']:disabled:first').trigger('change');
        }
    });

    $('select[name$=\'[country_id]\']:first').trigger('change');
</script>